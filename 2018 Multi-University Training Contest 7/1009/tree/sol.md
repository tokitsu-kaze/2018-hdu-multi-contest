首先树分块，我们维护这几个东西
$a[i]$就是题目中的$a[i]$
$cnt[i]$当前节点跳多少步才能到下个块
$b[i]$当前节点跳$cnt[i]$步后到哪个节点，就是下一块的第一个节点是什么
修改的时候，暴力扫自己块里面所有节点，如果这个节点要经过$x$的话就直接修改$cnt$
然后修改$cnt[x]$和$a[x]$，就维护完了所有东西
当然这道题也可以LCT，不过常数较大，实际运算速度与分块差别不大。